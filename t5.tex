\section{Numerical Solution of PDEs with the Finite Elements Method}

\subsection{The Finite Elements Method (FEM)}

\subsubsection{From the strong form to the weak form}

Given the following problem in \textbf{strong form}: 

\[
  \begin{cases}
    \nabla\cdot\left(\subTilde{A}\,\nabla u\right) = -s \quad &\text{in }\Omega\\
    u = u_D \quad &\text{on } \Gamma_D\\
    \subTilde{A}\frac{\partial u}{\partial n} = q \quad &\text{on } \Gamma_N
  \end{cases}
\]

Where 
\begin{align*}
      \Gamma_D\cup\Gamma_N &= \partial\Omega\\
      \Gamma_D\cap\Gamma_N &= \varnothing
\end{align*}

$s$ is the source term (it's a function), but for the moment we'll assume that both $s$ and $\subTilde{A}$ don't depend on $u$. \\

We'll derive the equivalent weak form of the problem using \textbf{weighted residuals}:

\[
  \int_\Omega\omega\nabla\cdot\left(\subTilde{A}\,\nabla u\right)\,d\Omega = -\int_\Omega \omega s \, d\Omega \qquad\forall \omega \text{ such that } \omega = 0 \text{ on } \Gamma_D
\]

Where $\omega$ is the \textbf{test function} (or \textbf{weighting function}). \\

We integrate by parts (in particular we use \href{https://en.wikipedia.org/wiki/Green's_identities}{Green's first identity}):

\[
  -\int_{\Omega} \nabla\omega\cdot\left(\subTilde{A}\,\nabla u\right)\,d\Omega + \int_{\partial\Omega} \omega\subTilde{A}\nabla u\cdot\Bar{n} \,d\Gamma = -\int_\Omega \omega s \, d\Omega
\]\-\\
Let's have a look at the term on $\partial\Omega$

\[
  \int_{\partial\Omega} \omega\subTilde{A}\nabla u\cdot\Bar{n} \,d\Gamma = \int_{\Gamma_D} \cancelto{^{\footnotesize{\scriptstyle{0} \text{ (by def)}}}}{\omega} \hspace{-1.2cm}\subTilde{A}\nabla u\cdot\Bar{n} \,d\Gamma + \int_{\Gamma_N} \omega\underbrace{\subTilde{A}\nabla u\cdot\Bar{n}}_{q} \,d\Gamma = \int_{\Gamma_N} \omega q \, d\Gamma
\]

And with that, we get \\

\underline{\textbf{Weak form}} \\

We have to find $u$ such that $u = u_D$ on $\Gamma_D$ and 

\[
  \int_{\Omega} \nabla\omega\cdot\left(\subTilde{A}\,\nabla u\right)\,d\Omega = \int_\Omega \omega s \, d\Omega + \int_{\Gamma_N} \omega q \, d\Gamma \qquad \forall \omega \text{ such that } \omega = 0 \text{ on } \Gamma_D
\]
\newpage

So $$u \in \mathcal{H}_{\Gamma_D}^1(\Omega) = \setb{u\in\mathcal{H}^1(\Omega)\, \big| \, u=u_D \text{ on } \Gamma_D}$$

and $$\omega \in \mathcal{H}_{\Gamma_D,0}^1(\Omega) = \setb{u \in \mathcal{H}^1(\Omega) \,\big| \, u = 0 \text{ on } \Gamma_D}$$ \-\\
Where $$\mathcal{H}^1(\Omega) = \setb{f\in L^2(\Omega)\, \big| \, \frac{\partial f}{\partial x_i}\in L^2(\Omega)\quad \forall i} \qquad L^2(\Omega) = \setb{f \, \big| \, \int_{\Omega} f^2\,d\Omega < \infty}$$\-\\

Now that we have the weak form, what we do is discretize the domain.

\subsubsection{Discretisation}

The mesh is defined by a set of points and triangles like:

\begin{figure}[h]
    \centering
    \definecolor{xdxdff}{rgb}{0.49019607843137253,0.49019607843137253,1.}
\definecolor{ududff}{rgb}{0.30196078431372547,0.30196078431372547,1.}
\begin{tikzpicture}[line cap=round,line join=round,>=triangle 45,x=1.0cm,y=1.0cm]
\clip(1.6,-3.5) rectangle (12.9,2.7);
\draw[line width=1.pt, smooth,samples=100,domain=0.0:0.12] plot[parametric] function{75.25*t**(3.0)+0.0*t**(2.0)+7.52*t+2.02,-84.83*t**(3.0)+0.0*t**(2.0)+10.33*t+0.64};
\draw[line width=1.pt, smooth,samples=100,domain=0.12:0.24] plot[parametric] function{-96.18*t**(3.0)+59.18*t**(2.0)+0.71*t+2.28,-35.0*t**(3.0)-17.2*t**(2.0)+12.31*t+0.56};
\draw[line width=1.pt, smooth,samples=100,domain=0.24:0.34] plot[parametric] function{-2.71*t**(3.0)-8.78*t**(2.0)+17.18*t+0.95,112.71*t**(3.0)-124.59*t**(2.0)+38.34*t-1.54};
\draw[line width=1.pt, smooth,samples=100,domain=0.34:0.41] plot[parametric] function{79.9*t**(3.0)-91.82*t**(2.0)+45.01*t-2.16,75.81*t**(3.0)-87.5*t**(2.0)+25.91*t-0.15};
\draw[line width=1.pt, smooth,samples=100,domain=0.41:0.5] plot[parametric] function{13.49*t**(3.0)-9.87*t**(2.0)+11.3*t+2.46,70.33*t**(3.0)-80.73*t**(2.0)+23.13*t+0.23};
\draw[line width=1.pt, smooth,samples=100,domain=0.5:0.56] plot[parametric] function{-51.11*t**(3.0)+87.16*t**(2.0)-37.28*t+10.57,-94.01*t**(3.0)+166.12*t**(2.0)-100.47*t+20.86};
\draw[line width=1.pt, smooth,samples=100,domain=0.56:0.64] plot[parametric] function{-1.28*t**(3.0)+3.34*t**(2.0)+9.71*t+1.79,-8.34*t**(3.0)+22.01*t**(2.0)-19.67*t+5.76};
\draw[line width=1.pt, smooth,samples=100,domain=0.64:0.72] plot[parametric] function{-0.48*t**(3.0)+1.79*t**(2.0)+10.71*t+1.58,3.42*t**(3.0)-0.57*t**(2.0)-5.21*t+2.67};
\draw[line width=1.pt, smooth,samples=100,domain=0.72:0.8] plot[parametric] function{-20.09*t**(3.0)+44.27*t**(2.0)-19.95*t+8.95,-166.5*t**(3.0)+367.38*t**(2.0)-270.81*t+66.58};
\draw[line width=1.pt, smooth,samples=100,domain=0.8:0.85] plot[parametric] function{-120.37*t**(3.0)+283.57*t**(2.0)-210.3*t+59.42,-105.76*t**(3.0)+222.45*t**(2.0)-155.53*t+36.01};
\draw[line width=1.pt, smooth,samples=100,domain=0.85:0.94] plot[parametric] function{-143.65*t**(3.0)+343.17*t**(2.0)-261.17*t+73.89,143.87*t**(3.0)-416.7*t**(2.0)+389.96*t-119.17};
\draw[line width=1.pt, smooth,samples=100,domain=0.0:0.07] plot[parametric] function{393.9*t**(3.0)+0.0*t**(2.0)-2.67*t+2.02,67.04*t**(3.0)+0.0*t**(2.0)-12.5*t+0.64};
\draw[line width=1.pt, smooth,samples=100,domain=0.07:0.13] plot[parametric] function{-337.89*t**(3.0)+147.54*t**(2.0)-12.59*t+2.24,68.66*t**(3.0)-0.33*t**(2.0)-12.48*t+0.64};
\draw[line width=1.pt, smooth,samples=100,domain=0.13:0.21] plot[parametric] function{-43.7*t**(3.0)+34.53*t**(2.0)+1.88*t+1.62,-53.54*t**(3.0)+46.61*t**(2.0)-18.49*t+0.9};
\draw[line width=1.pt, smooth,samples=100,domain=0.21:0.31] plot[parametric] function{-21.13*t**(3.0)+20.17*t**(2.0)+4.93*t+1.41,-46.39*t**(3.0)+42.06*t**(2.0)-17.53*t+0.83};
\draw[line width=1.pt, smooth,samples=100,domain=0.31:0.44] plot[parametric] function{10.17*t**(3.0)-9.22*t**(2.0)+14.13*t+0.45,60.42*t**(3.0)-58.23*t**(2.0)+13.86*t-2.45};
\draw[line width=1.pt, smooth,samples=100,domain=0.44:0.56] plot[parametric] function{-16.23*t**(3.0)+25.85*t**(2.0)-1.4*t+2.74,-67.07*t**(3.0)+111.11*t**(2.0)-61.11*t+8.62};
\draw[line width=1.pt, smooth,samples=100,domain=0.56:0.68] plot[parametric] function{6.95*t**(3.0)-12.91*t**(2.0)+20.2*t-1.27,3.67*t**(3.0)-7.16*t**(2.0)+4.8*t-3.63};
\draw[line width=1.pt, smooth,samples=100,domain=0.68:0.77] plot[parametric] function{-17.33*t**(3.0)+36.26*t**(2.0)-12.99*t+6.2,-45.12*t**(3.0)+91.66*t**(2.0)-61.9*t+11.38};
\draw[line width=1.pt, smooth,samples=100,domain=0.77:0.86] plot[parametric] function{50.85*t**(3.0)-120.86*t**(2.0)+107.71*t-24.71,72.61*t**(3.0)-179.67*t**(2.0)+146.53*t-41.99};
\draw[line width=1.pt, smooth,samples=100,domain=0.86:0.94] plot[parametric] function{-229.77*t**(3.0)+604.9*t**(2.0)-517.97*t+155.09,319.02*t**(3.0)-816.96*t**(2.0)+695.94*t-199.87};
\draw [line width=1.pt] (3.,1.7)-- (3.42,0.46);
\draw [line width=1.pt] (2.02,0.64)-- (3.42,0.46);
\draw [line width=1.pt] (3.42,0.46)-- (1.96,-0.18);
\draw [line width=1.pt] (3.42,0.46)-- (2.34,-0.82);
\draw [line width=1.pt] (3.42,0.46)-- (3.74,-0.78);
\draw [line width=1.pt] (3.74,-0.78)-- (2.34,-0.82);
\draw [line width=1.pt] (3.74,-0.78)-- (3.16,-1.44);
\draw [line width=1.pt] (3.42,0.46)-- (4.04,1.2);
\draw [line width=1.pt] (3.,1.7)-- (4.04,1.2);
\draw [line width=1.pt] (3.,1.7)-- (2.4942912053784743,1.249476159149053);
\draw [line width=1.pt] (2.4942912053784743,1.249476159149053)-- (3.42,0.46);
\draw [line width=1.pt] (3.,1.7)-- (3.712654741773794,2.0071982078016495);
\draw [line width=1.pt] (3.712654741773794,2.0071982078016495)-- (4.04,1.2);
\draw [line width=1.pt] (4.56,2.04)-- (4.04,1.2);
\draw [line width=1.pt] (4.04,1.2)-- (4.56,0.08);
\draw [line width=1.pt] (4.56,0.08)-- (3.42,0.46);
\draw [line width=1.pt] (3.74,-0.78)-- (4.56,0.08);
\draw [line width=1.pt] (4.56,0.08)-- (4.8,-1.18);
\draw [line width=1.pt] (4.8,-1.18)-- (3.74,-0.78);
\draw [line width=1.pt] (3.74,-0.78)-- (4.28,-1.96);
\draw [line width=1.pt] (4.28,-1.96)-- (4.8,-1.18);
\draw [line width=1.pt] (4.56,0.08)-- (5.14,0.74);
\draw [line width=1.pt] (4.04,1.2)-- (5.14,0.74);
\draw [line width=1.pt] (5.14,0.74)-- (4.56,2.04);
\draw [line width=1.pt] (5.14,0.74)-- (5.62,1.56);
\draw [line width=1.pt] (5.14,0.74)-- (6.38,0.98);
\draw [line width=1.pt] (6.38,0.98)-- (5.84,-0.04);
\draw [line width=1.pt] (5.84,-0.04)-- (5.14,0.74);
\draw [line width=1.pt] (4.56,0.08)-- (5.84,-0.04);
\draw [line width=1.pt] (5.84,-0.04)-- (4.8,-1.18);
\draw [line width=1.pt] (4.8,-1.18)-- (5.113955707955139,-2.29710660508585);
\draw [line width=1.pt] (5.113955707955139,-2.29710660508585)-- (5.88,-1.66);
\draw [line width=1.pt] (4.8,-1.18)-- (5.88,-1.66);
\draw [line width=1.pt] (5.88,-1.66)-- (5.84,-0.04);
\draw [line width=1.pt] (5.84,-0.04)-- (6.825974218356539,0.669567582001636);
\draw [line width=1.pt] (6.825974218356539,0.669567582001636)-- (6.72,-0.44);
\draw [line width=1.pt] (6.72,-0.44)-- (5.84,-0.04);
\draw [line width=1.pt] (5.88,-1.66)-- (6.72,-0.44);
\draw [line width=1.pt] (5.88,-1.66)-- (5.78,-2.48);
\draw [line width=1.pt] (5.78,-2.48)-- (6.62,-1.82);
\draw [line width=1.pt] (6.62,-1.82)-- (6.439881234920367,-2.543484329382041);
\draw [line width=1.pt] (6.62,-1.82)-- (5.88,-1.66);
\draw [line width=1.pt] (6.62,-1.82)-- (6.72,-0.44);
\draw [line width=1.pt] (6.72,-0.44)-- (7.34,0.4);
\draw [line width=1.pt] (6.72,-0.44)-- (7.7,-0.82);
\draw [line width=1.pt] (7.7,-0.82)-- (7.34,0.4);
\draw [line width=1.pt] (7.7,-0.82)-- (8.06,0.18);
\draw [line width=1.pt] (7.7,-0.82)-- (9.04,0.);
\draw [line width=1.pt] (6.62,-1.82)-- (7.7,-0.82);
\draw [line width=1.pt] (6.62,-1.82)-- (7.18,-2.54);
\draw [line width=1.pt] (7.18,-2.54)-- (7.7,-0.82);
\draw [line width=1.pt] (7.7,-0.82)-- (8.62,-2.52);
\draw [line width=1.pt] (7.8,-1.86)-- (7.18,-2.54);
\draw [line width=1.pt] (7.8,-1.86)-- (8.62,-2.52);
\draw [line width=1.pt] (7.8,-1.86)-- (7.7,-0.82);
\draw [line width=1.pt] (9.04,0.)-- (8.76,-1.14);
\draw [line width=1.pt] (8.76,-1.14)-- (7.7,-0.82);
\draw [line width=1.pt] (8.76,-1.14)-- (8.62,-2.52);
\draw [line width=1.pt] (8.76,-1.14)-- (9.76,-2.54);
\draw [line width=1.pt] (9.76,-2.54)-- (9.58,-1.32);
\draw [line width=1.pt] (9.58,-1.32)-- (8.76,-1.14);
\draw [line width=1.pt] (5.092888033673837,1.8678505213242278)-- (5.14,0.74);
\draw [line width=1.pt] (4.0628882464444835,2.0625098738473846)-- (4.04,1.2);
\draw [line width=1.pt] (1.9491558597261478,0.2563349465687549)-- (3.42,0.46);
\draw [line width=1.pt] (2.0989776852520947,-0.5084240269385761)-- (3.42,0.46);
\draw [line width=1.pt] (2.7145919118495003,-1.1537811154633195)-- (3.74,-0.78);
\draw [line width=1.pt] (9.58,-1.32)-- (9.04,0.);
\draw [line width=1.pt] (9.58,-1.32)-- (10.06,-0.1);
\draw [line width=1.pt] (10.06,-0.1)-- (10.54,-1.1);
\draw [line width=1.pt] (10.54,-1.1)-- (9.58,-1.32);
\draw [line width=1.pt] (10.54,-1.1)-- (10.98,-0.18);
\draw [line width=1.pt] (10.54,-1.1)-- (11.66,-0.44);
\draw [line width=1.pt] (11.286580727568996,-0.2608506072605792)-- (10.54,-1.1);
\draw [line width=1.pt] (10.54,-1.1)-- (9.76,-2.54);
\draw [line width=1.pt] (10.54,-1.1)-- (10.9,-2.68);
\draw [line width=1.pt] (10.9,-2.68)-- (11.28,-1.44);
\draw [line width=1.pt] (11.28,-1.44)-- (10.54,-1.1);
\draw [line width=1.pt] (11.66,-0.44)-- (11.28,-1.44);
\draw [line width=1.pt] (11.28,-1.44)-- (12.033119901892462,-0.7777540285797073);
\draw [line width=1.pt] (12.3,-1.28)-- (11.28,-1.44);
\draw [line width=1.pt] (11.82,-2.6)-- (11.28,-1.44);
\draw [line width=1.pt] (12.36,-2.06)-- (11.28,-1.44);
\draw [line width=1.pt] (12.36,-2.06)-- (11.82,-2.6);
\draw [line width=1.pt] (12.36,-2.06)-- (12.3,-1.28);
\draw [line width=1.pt] (11.379210153953807,-2.703128564449173)-- (11.28,-1.44);
\draw [line width=1.pt] (10.307753337995514,-2.6033413516884565)-- (10.54,-1.1);
\draw [line width=1.pt] (9.120009503922319,-2.5164145643048688)-- (8.76,-1.14);
\begin{scriptsize}
\draw [fill=ududff] (2.02,0.64) circle (2.5pt);
\draw [fill=ududff] (3.,1.7) circle (2.5pt);
\draw [fill=ududff] (4.56,2.04) circle (2.5pt);
\draw [fill=ududff] (5.62,1.56) circle (2.5pt);
\draw [fill=ududff] (6.38,0.98) circle (2.5pt);
\draw [fill=ududff] (7.34,0.4) circle (2.5pt);
\draw [fill=ududff] (8.06,0.18) circle (2.5pt);
\draw [fill=ududff] (9.04,0.) circle (2.5pt);
\draw [fill=ududff] (10.06,-0.1) circle (2.5pt);
\draw [fill=ududff] (10.98,-0.18) circle (2.5pt);
\draw [fill=ududff] (11.66,-0.44) circle (2.5pt);
\draw [fill=ududff] (12.3,-1.28) circle (2.5pt);
\draw [fill=ududff] (12.36,-2.06) circle (2.5pt);
\draw [fill=ududff] (1.96,-0.18) circle (2.5pt);
\draw [fill=ududff] (2.34,-0.82) circle (2.5pt);
\draw [fill=ududff] (3.16,-1.44) circle (2.5pt);
\draw [fill=ududff] (4.28,-1.96) circle (2.5pt);
\draw [fill=ududff] (5.78,-2.48) circle (2.5pt);
\draw [fill=ududff] (7.18,-2.54) circle (2.5pt);
\draw [fill=ududff] (8.62,-2.52) circle (2.5pt);
\draw [fill=ududff] (9.76,-2.54) circle (2.5pt);
\draw [fill=ududff] (10.9,-2.68) circle (2.5pt);
\draw [fill=ududff] (11.82,-2.6) circle (2.5pt);
\draw [fill=ududff] (3.42,0.46) circle (2.5pt);
\draw [fill=ududff] (3.74,-0.78) circle (2.5pt);
\draw [fill=ududff] (4.04,1.2) circle (2.5pt);
\draw [fill=xdxdff] (2.4942912053784743,1.249476159149053) circle (2.5pt);
\draw [fill=xdxdff] (3.712654741773794,2.0071982078016495) circle (2.5pt);
\draw [fill=ududff] (4.56,0.08) circle (2.5pt);
\draw [fill=ududff] (4.8,-1.18) circle (2.5pt);
\draw [fill=ududff] (5.14,0.74) circle (2.5pt);
\draw [fill=ududff] (5.84,-0.04) circle (2.5pt);
\draw [fill=xdxdff] (5.113955707955139,-2.29710660508585) circle (2.5pt);
\draw [fill=ududff] (5.88,-1.66) circle (2.5pt);
\draw [fill=xdxdff] (6.825974218356539,0.669567582001636) circle (2.5pt);
\draw [fill=ududff] (6.72,-0.44) circle (2.5pt);
\draw [fill=ududff] (6.62,-1.82) circle (2.5pt);
\draw [fill=xdxdff] (6.439881234920367,-2.543484329382041) circle (2.5pt);
\draw [fill=ududff] (7.7,-0.82) circle (2.5pt);
\draw [fill=ududff] (7.8,-1.86) circle (2.5pt);
\draw [fill=ududff] (8.76,-1.14) circle (2.5pt);
\draw [fill=ududff] (9.58,-1.32) circle (2.5pt);
\draw [fill=xdxdff] (5.092888033673837,1.8678505213242278) circle (2.5pt);
\draw [fill=xdxdff] (4.0628882464444835,2.0625098738473846) circle (2.5pt);
\draw [fill=xdxdff] (1.9491558597261478,0.2563349465687549) circle (2.5pt);
\draw [fill=xdxdff] (2.0989776852520947,-0.5084240269385761) circle (2.5pt);
\draw [fill=xdxdff] (2.7145919118495003,-1.1537811154633195) circle (2.5pt);
\draw [fill=ududff] (10.54,-1.1) circle (2.5pt);
\draw [fill=xdxdff] (11.286580727568996,-0.2608506072605792) circle (2.5pt);
\draw [fill=ududff] (11.28,-1.44) circle (2.5pt);
\draw [fill=xdxdff] (12.033119901892462,-0.7777540285797073) circle (2.5pt);
\draw [fill=xdxdff] (11.379210153953807,-2.703128564449173) circle (2.5pt);
\draw [fill=xdxdff] (10.307753337995514,-2.6033413516884565) circle (2.5pt);
\draw [fill=xdxdff] (9.120009503922319,-2.5164145643048688) circle (2.5pt);
\end{scriptsize}
\end{tikzpicture}
\caption{Mesh of a domain $\Omega$}
    \label{fig:mesh}
\end{figure}

We want the nodal values of the solution noted $u_i$ ($i = 1,\ldots,n_{\text{nodes}}$).\\

We'll approximate the solution $u$ by:

\[
  u \simeq \sum_i N_i(x)u_i
\]
\begin{definition}
  We define the \textbf{shape function} $N_i(x)$ as
  \[
    N_i(x_j) = \delta_{ij} = \begin{cases} 1 \text{ if } i=j \\ 0 \text{ otherwise} \end{cases}
  \]
  where $x_i$ is a node on the mesh.
  \begin{figure}
      \centering
      \definecolor{qqwwzz}{rgb}{0.,0.4,0.6}
      \begin{tikzpicture}[line cap=round,line join=round,>=triangle 45,x=1.0cm,y=1.0cm,scale=1.5]
        \clip(6.,-3.) rectangle (12.141,-0.5);
        \draw [line width=1.pt,domain=6.:12.141] plot(\x,{(-32.832-0.*\x)/13.68});
        \draw [line width=1.pt,color=qqwwzz] (6.02,-2.4)-- (7.72,-2.4);
        \draw [line width=1.pt,color=qqwwzz] (7.72,-2.4)-- (9.18,-1.);
        \draw [line width=1.pt,color=qqwwzz] (9.18,-1.)-- (10.66,-2.4);
        \draw [line width=1.pt,color=qqwwzz] (10.66,-2.4)-- (12.1,-2.4);
        \draw (8.9,-2.44) node[anchor=north west] {$x_i$};
        \draw (9.8,-1.1) node[anchor=north west] {$N_i$};
        \begin{scriptsize}
        \draw [color=black] (6.02,-2.4)-- ++(-2.0pt,0 pt) -- ++(4.0pt,0 pt) ++(-2.0pt,-2.0pt) -- ++(0 pt,4.0pt);
        \draw [color=black] (7.72,-2.4)-- ++(-2.0pt,0 pt) -- ++(4.0pt,0 pt) ++(-2.0pt,-2.0pt) -- ++(0 pt,4.0pt);
        \draw [color=black] (9.18,-2.4)-- ++(-2.0pt,0 pt) -- ++(4.0pt,0 pt) ++(-2.0pt,-2.0pt) -- ++(0 pt,4.0pt);
        \draw [color=black] (10.66,-2.4)-- ++(-2.0pt,0 pt) -- ++(4.0pt,0 pt) ++(-2.0pt,-2.0pt) -- ++(0 pt,4.0pt);
        \draw [color=black] (12.1,-2.4)-- ++(-2.0pt,0 pt) -- ++(4.0pt,0 pt) ++(-2.0pt,-2.0pt) -- ++(0 pt,4.0pt);
        \draw [fill=black] (9.18,-1.) circle (1.0pt);
        \end{scriptsize}
      \end{tikzpicture}
      \caption{$N_i$ are piecewise polynomials with compact support}
      \label{fig:Ni}
  \end{figure}
\end{definition}

Previously, we had to choose $\omega$ as the weighting function. The common approach is with the \textit{Galerkin approximation}: $$\omega = N_i \qquad i = 1,\ldots,n_{\text{nodes}}$$

For every $\omega$ chosen, we have an equation, so we choose as many $\omega$'s as unknowns. \\

Then 
\[
  \int_\Omega \nabla N_i \cdot \subTilde{A}\left(\sum_j\nabla N_ju_j\right)\,d\Omega = \int_\Omega N_is\,d\Omega + \int_{\Gamma_N}N_iq\,d\Gamma
\]
\[
  \sum_j\underbrace{\int_\Omega\left(\nabla N_i\cdot\subTilde{A}\nabla N_j\right)}_{K_{ij}}\,d\Omega \,\, u_j = \underbrace{\int_\Omega N_is\,d\Omega + \int_{\Gamma_N}N_iq\,d\Gamma}_{f_i}
\]

So we end up with the system

\[
  \sum_jK_{ij}u_j = f_i \qquad i=1,\ldots,n_{\text{nodes}}
\]

and in matrix form
\[
  \subTilde{K}\Bar{u} = \bar{f}
\]\-\\
The \textbf{stiffness matrix} $\subTilde{K}$ is singular, so we need to impose the Dirichlet conditions:

\[
  \sum_{j=1}^{n_{\text{nodes}}} N_j(x)u_j = \sum_{j\in U}N_j(x)u_j + \sum_{j\in D}N_j(x)u_j \qquad (u_j=u_D(x_j))
\]

where $\begin{cases}
    j\in D \text{ if } x_j \in \Gamma_D\\ j\in U \text{ if } x_j\not\in \Gamma_D
\end{cases}$

\newpage

\begin{example}
We'll work with the following 1D problem:
\[
  \begin{cases}
    -u_{xx} = f \\
    u(0) = 0, \, u(1) = 1
  \end{cases}
\]

with 
  \begin{figure}[h]
      \centering
      \definecolor{yqyqyq}{rgb}{0.5019607843137255,0.5019607843137255,0.5019607843137255}
        \definecolor{qqqqtt}{rgb}{0.,0.,0.2}
        \definecolor{qqttzz}{rgb}{0.,0.2,0.6}
        \definecolor{qqwwzz}{rgb}{0.,0.4,0.6}
        \begin{tikzpicture}[line cap=round,line join=round,>=triangle 45,x=12.0cm,y=4.8cm, scale = 0.8]
        \begin{axis}[
        x=12.0cm,y=4.8cm,
        axis lines=middle,
        xmin=-0.05,
        xmax=1.02,
        ymin=-0.2,
        ymax=1.12,
        xtick={-0.0,0.1,...,1.1},
        ytick={-0.0,1.0,...,1.0},]
        \clip(-0.05,-0.2) rectangle (1.02,1.12);
        \draw (0.17342001878856841,1.12) node[anchor=north west] {$N_1$};
        \draw (0.37535408033237305,1.12) node[anchor=north west] {$N_2$};
        \draw (0.6716703662933907,1.12) node[anchor=north west] {$N_3$};
        \draw (0.9306727495778357,1.12) node[anchor=north west] {$\psi$};
        \draw (-0.04826846181930405,-0.010428039332540924) node[anchor=north west] {$x_0$};
        \draw (0.175,-0.12) node[anchor=north west] {$x_1$};
        \draw (0.375,-0.12) node[anchor=north west] {$x_2$};
        \draw (0.675,-0.12) node[anchor=north west] {$x_3$};
        \draw (0.975,-0.12) node[anchor=north west] {$x_4$};
        \draw [line width=1.pt,color=qqwwzz] (-2.501762441637411E-4,0.)-- (0.1993279293434915,0.9966396467174575);
        \draw [line width=1.pt,color=qqwwzz] (0.1993279293434915,0.9966396467174575)-- (0.39890603493114674,0.);
        \draw [line width=1.pt,color=qqttzz] (0.1993279293434915,0.)-- (0.40112356943767624,0.9962547685410791);
        \draw [line width=1.pt,color=qqttzz] (0.40112356943767624,0.9962547685410791)-- (0.7004907278191591,0.0016357593971971784);
        \draw [line width=1.pt,color=qqttzz] (0.7004907278191591,0.0016357593971971784)-- (1.0508611798508205,0.);
        \draw [line width=1.pt,color=qqwwzz] (0.39890603493114674,0.)-- (0.7001812029617619,0.0026641263985551777);
        \draw [line width=1.pt,color=qqqqtt] (0.6982731933126296,0.9942439777087653)-- (0.3987606852809381,7.258372535798863E-4);
        \draw [line width=1.pt,color=qqqqtt] (0.6982731933126296,0.9942439777087653)-- (1,2.588335028239439E-4);
        \draw [line width=1.pt,color=qqqqtt] (0.3985896937652761,0.0015797231207659995)-- (-0.0556885389074013,0.);
        \draw [line width=1.pt,color=yqyqyq] (0.7003484276096387,0.0021085383558490656)-- (1.0222763403956587,1.0742544679855293);
        \draw [<->,line width=0.5 pt] (0.025,0.05) -- (0.19,0.05);
        \draw [<->,line width=0.5 pt] (0.22,0.05) -- (0.38,0.05);
        \draw [<->,line width=0.5 pt] (0.42,0.05) -- (0.68,0.05);
        \draw [<->,line width=0.5 pt] (0.72,0.05) -- (0.98,0.05);
        \draw (0.11,0.17) node[anchor=north] {$h_1$};
        \draw (0.3,0.17) node[anchor=north] {$h_2$};
        \draw (0.55,0.17) node[anchor=north] {$h_3$};
        \draw (0.85,0.17) node[anchor=north] {$h_4$};
        \end{axis}
        \end{tikzpicture}
      \caption{}
      \label{fig:1D FEM}
  \end{figure}
  
First we'll write the weak form to approximate $u(x)$ by functions in $\mathcal{H}_0^1(0,1)$ to get 
\begin{equation}\label{eq:FEMex}
    u(x) \simeq u^h =  u_1N_1(x) + u_2N_2(x) + u_3N_3(x) + \psi(x)
\end{equation}

Let's proceed

\[
  -\int_0^1u_{xx}\omega \, dx = \int_0^1 f\omega \, dx
\]

We integrate the left hand side by parts:

\[
  -\int_0^1u_{xx}\omega \, dx = -\big[\omega u_x\big]_0^1 + \int_0^1u_x\omega_x\,dx
\]\-\\
$\omega \in \mathcal{H}_0^1(0,1) \implies \omega(0) = \omega(1) = 0\implies \omega u_x\big|_0^1=0$\\

\underline{\textbf{Weak form}}\\

We have to find $u$ such that $u(0) = 0$, $u(1) = 1$ and $$\int_0^1u_x\omega_x\,dx = \int_0^1f\omega \, dx \qquad \forall\omega\in\mathcal{H}_0^1(0,1)$$

\newpage

Let's rewrite $\int_0^1u_x\omega_x\,dx$ using our approximation of u (\ref{eq:FEMex}):

\[
  \int_0^1 u_x\omega_x\, dx = \int_0^1\left(u_1N_1'(x) + u_2N_2'(x) + u_3N_3'(x) + \psi'(x)\right)\cdot N_i'(x)\,dx \qquad i=1,2,3
\]

Thus

\[
  \sum_{j=1}^3 u_j\underbrace{\int_0^1 N_j'(x)\cdot N_i'(x) \,dx}_{K_{ij}} = \underbrace{\int_0^1fN_i(x)\,dx - \int_0^1\psi'(x)N_i'(x)}_{f_i} \qquad i=1,2,3
\]\-\\

Let's find the explicit form of the $N_i's$ with the discretisation in Figure \ref{fig:1D FEM}:\\

    $N_1(x)=\begin{cases}
      5x                       &0\leq x\leq 0.2\\
      -5(x-0.4)                &0.2\leq x\leq0.4\\
      0  \qquad   \qquad \quad &\text{otherwise}
    \end{cases}$\\\-\\
    
    $N_2(x)=\begin{cases} 
      5(x-0.2)                  &0.2\leq x \leq 0.4 \\
      -\frac{10}{3}(x-0.7)      &0.4\leq x \leq 0.7 \\
      0  \qquad   \qquad \quad  &\text{otherwise}
    \end{cases}$\\\-\\
    
    $N_3(x)=\begin{cases} 
      \frac{10}{3}(x-0.4)       &0.4\leq x \leq 0.7 \\
      -\frac{10}{3}(x-1)        &0.7\leq x \leq 1 \\
      0  \qquad   \qquad \quad  &\text{otherwise}
    \end{cases}$\\\-\\
  
Now we can find the $K_{ij}$'s:

$\displaystyle{
  K_{11} = \int_0^1 N_1'(x)\cdot N_1'(x) \, dx = \int_0^{0.2} 5\cdot5\,dx + \int_{0.2}^{0.4} (-5)\cdot(-5)\,dx = 10}
$\\\-\\
$\displaystyle{
  K_{12}=K_{21} = \int_{0.2}^{0.4}(-5)\cdot5 \,dx = -5}
$\\\-\\
$\displaystyle{
  K_{13} = K_{31} = 0}
$\\\-\\
$\displaystyle{
  K_{22} = \int_{0.2}^{0.4}5\cdot5\,dx + \int_{0.4}^{0.7}\frac{-10}{3}\cdot\frac{-10}{3}\,dx = \frac{25}{3}}
$\\\-\\
$\displaystyle{
  K_{23}=K_{32} = \int_{0.4}^{0.7}\frac{-10}{3}\cdot\frac{10}{3}\,dx = -\frac{10}{3}}
$\\\-\\
$\displaystyle{
  K_{33} = \int_{0.4}^{0.7}\frac{10}{3}\cdot\frac{10}{3}\,dx + \int_{0.7}^1 \frac{-10}{3}\cdot\frac{-10}{3}\,dx = \frac{20}{3}}
$\\\-\\
\newpage

So 

\[
  \subTilde{K} =
  \begin{pmatrix*}[r]
    10 & -5            & 0\\[0.1cm]
    -5 & \frac{25}{3}  & -\frac{10}{3}\\[0.1cm]
    0  & -\frac{10}{3} & \frac{20}{3}
  \end{pmatrix*}
\]

and the system we have to solve is:

\[
  \begin{pmatrix*}[r]
    10 & -5            & 0\\[0.1cm]
    -5 & \frac{25}{3}  & -\frac{10}{3}\\[0.1cm]
    0  & -\frac{10}{3} & \frac{20}{3}
  \end{pmatrix*}
  \begin{pmatrix*}[r]
    u_1\\ u_2 \\ u_3
  \end{pmatrix*} =
  \begin{pmatrix*}[r]
    f_1\\f_2\\f_3
  \end{pmatrix*}
\]\-\\
Let's find a general way to compute $\subTilde{K}$ with discretisations like the one in Figure \ref{fig:1D FEM}:\\

$\displaystyle{K_{11} = \int_0^1 N_1'N_1' \, dx = \int_{x_0}^{x_1} \left(\frac{1}{h_1}\right)^2\,dx + \int_{x_1}^{x_2} \left(-\frac{1}{h_2}\right)^2\,dx = \frac{1}{h_1} + \frac{1}{h_2}}$ \\\-\\
$\displaystyle{K_{12} = K_{21} = \int_0^1 N_1'N_2' \, dx = \int_{x_1}^{x_2} -\frac{1}{h_2}\cdot \frac{1}{h_2}\,dx = -\frac{1}{h_2}}$ \\
$\vdots$
\[
  \implies 
  \subTilde{K} =
  \begin{pmatrix*}[c]
    \frac{1}{h_1} + \frac{1}{h_2} & -\frac{1}{h_2}                 & 0                             \\[0.25cm]
    -\frac{1}{h_2}                & \frac{1}{h_2} + \frac{1}{h_3}  & -\frac{1}{h_3}                \\[0.25cm]
    0                             & -\frac{1}{h_3}                 & \frac{1}{h_3} + \frac{1}{h_4}
  \end{pmatrix*}
\]\-\\
The solution needs to verify the Dirichlet conditions, so we'll impose $$\psi = 0\cdot N_0 + 1\cdot N_4 = N_4$$

Assuming $f$ constant, the system we have to solve is

\begin{equation}\label{eq:sys5.2}
  \begin{pmatrix*}[c]
    \frac{1}{h_1} + \frac{1}{h_2} & -\frac{1}{h_2}                 & 0                             \\[0.25cm]
    -\frac{1}{h_2}                & \frac{1}{h_2} + \frac{1}{h_3}  & -\frac{1}{h_3}                \\[0.25cm]
    0                             & -\frac{1}{h_3}                 & \frac{1}{h_3} + \frac{1}{h_4}
  \end{pmatrix*}
  \begin{pmatrix*}[r]
    u_1\\[0.25cm] u_2 \\[0.25cm] u_3
  \end{pmatrix*} =
  \begin{pmatrix*}[r]
    f\cdot \frac{h_1 + h_2}{2}\\[0.2cm] f\cdot \frac{h_2 + h_3}{2}\\[0.2cm] f\cdot \frac{h_3 + h_4}{2}
  \end{pmatrix*} + 
  \begin{pmatrix*}[c]
    0\\0\\ -\left(\frac{-1}{h_4}\right)
  \end{pmatrix*}
\end{equation}
$$\text{\rotatebox{270}{$\leadsto$}}$$
\[
  \begin{pmatrix*}[r]
    10 & -5            & 0\\[0.2cm]
    -5 & \frac{25}{3}  & -\frac{10}{3}\\[0.2cm]
    0  & -\frac{10}{3} & \frac{20}{3}
  \end{pmatrix*}
  \begin{pmatrix*}[r]
    u_1\\[0.2cm] u_2 \\[0.2cm] u_3
  \end{pmatrix*} =
  f\cdot\begin{pmatrix*}[c]
    0.2\\0.25\\0.3
  \end{pmatrix*} + 
  \begin{pmatrix*}[c]
    0\\0\\ \frac{10}{3}
  \end{pmatrix*}
\]
  

Taking for example $f=-2$, $$\Bar{u} = (0.04,\, 0.16,\,0.49)$$

And the approximation of the solution is

\[
  u^h(x) = \sum_{i=0}^4u_iN_i(x) = 0.04N_i(x) + 0.16N_2(x) + 0.49N_3(x) + N_4(x)
\]

\newpage

Of course, this is a toy problem. If things get more complicated, we analyze the problem locally:

\begin{figure}[h]
    \centering
    \definecolor{qqwwzz}{rgb}{0.,0.4,0.6}
    \definecolor{qqttzz}{rgb}{0.,0.2,0.6}
    \begin{tikzpicture}[line cap=round,line join=round,>=triangle 45,x=1cm,y=1.0cm]
    \clip(-0.1,-0.7) rectangle (5.05,3.6);
    \draw [line width=1.pt] (0.,0.)-- (5.,0.);
    \draw [line width=1.pt] (0.,0.)-- (5.,0.);
    \draw [line width=1.pt,color=qqttzz] (0.20519502132164286,0.)-- (4.79,3.35);
    \draw [line width=1.pt,color=qqwwzz] (4.786549922239208,0.)-- (0.21,3.5);
    \draw (0.5,-0.05) node[anchor=north] {$x_{e-1}$};
    \draw (4.8,-0.05) node[anchor=north] {$x_e$};
    \draw (1.4,3.4) node[anchor=north] {$N_{(1)}$};
    \draw (3.7,3.4) node[anchor=north] {$N_{(2)}$};
    \begin{scriptsize}
    \draw (0.1,0.6) node[anchor=north] {$(1)$};
    \draw (4.8,0.6) node[anchor=north] {$(2)$};
    \draw [color=black] (0.20519502132164286,0.)-- ++(-2.5pt,0 pt) -- ++(5.0pt,0 pt) ++(-2.5pt,-2.5pt) -- ++(0 pt,5.0pt);
    \draw [color=black] (4.786549922239208,0.)-- ++(-2.5pt,0 pt) -- ++(5.0pt,0 pt) ++(-2.5pt,-2.5pt) -- ++(0 pt,5.0pt);
    \end{scriptsize}
    \draw [<->,line width=0.5 pt] (0.8,0.3) -- (4.2,0.3);
    \draw (2.5,0.9) node[anchor=north] {$h_e$};
    \draw (2.5,-0.05) node[anchor=north] {$\Omega_e$};
    \end{tikzpicture}
    \caption{}
    \label{fig:local1Dmesh}
\end{figure}

With $$\int_0^1N_i'N_j' \, dx = \sum_{e=1}^4 \int_{\Omega_e} N_i'N_j' \, dx = \sum_{e=1}^4\int_{x_{e-1}}^{x_e}N_i'N_j'\,dx$$\\
$$N_{(1)}' = -\frac{1}{h_e} \qquad N_{(2)}' = \frac{1}{h_e}$$\\
$$\int_{\Omega_e}\left(N_{(1)}'\right)^2\, dx = \frac{1}{h_e} \qquad \int_{\Omega_e}\left(N_{(2)}'\right)^2\, dx = \frac{1}{h_e} \qquad \int_{\Omega_e}N_{(1)}'N_{(2)}'\, dx = -\frac{1}{h_e}$$\\
$$\int_{\Omega_e}N_{(1)}f \, dx = f\frac{h_e}{2} \qquad \int_{\Omega_e}N_{(2)}f \, dx = f\frac{h_e}{2}$$\\
And so, we define the \textbf{element matrix} as 

\[
  \begin{pmatrix*}[r]
    \dfrac{1}{h_e}  & -\dfrac{1}{h_e} \\[0.35cm]
    -\dfrac{1}{h_e} & \dfrac{1}{h_e}
  \end{pmatrix*}
\]

Then, we assemble our system as follows:

\newcommand{\tcb}[1]{\textcolor{CadetBlue}{#1}}
\newcommand{\tcm}[1]{\textcolor{Peach}{#1}}
\newcommand{\tcs}[1]{\textcolor{Maroon}{#1}}
\newcommand{\tcg}[1]{\textcolor{OliveGreen}{#1}}
\newcommand{\tce}[1]{\textcolor{MidnightBlue}{#1}}

\[
\begin{pmatrix}
  \tcb{\frac{1}{h_1}}  & \tcb{\frac{-1}{h_1}}                                                                                                                                     \\[0.2cm]
  \tcb{\frac{-1}{h_1}} & \tcb{\frac{1}{h_1}} + \tcm{\frac{1}{h_2}} & \tcm{\frac{-1}{h_2}}                                                                                         \\[0.2cm]
                       & \tcm{\frac{-1}{h_2}}                      & \tcm{\frac{1}{h_2}} + \tcs{\frac{1}{h_3}} & \tcs{\frac{-1}{h_3}}                                             \\[0.2cm]
                       &                                           & \tcs{\frac{-1}{h_3}}                      & \tcs{\frac{1}{h_3}} + \tcg{\frac{1}{h_4}} & \tcg{\frac{-1}{h_4}} \\[0.2cm]
                       &                                           &                                           & \tcg{\frac{-1}{h_4}}                      & \tcg{\frac{1}{h_4}}
\end{pmatrix}
\begin{pmatrix}
  u_0 \\[0.2cm] u_1 \\[0.2cm] u_2 \\[0.2cm] u_3 \\[0.2cm] u_4
\end{pmatrix} = 
f\cdot
\begin{pmatrix}
  \tcb{\frac{h_1}{2}} \\[0.2cm] \tcb{\frac{h_1}{2}} + \tcm{\frac{h_2}{2}} \\[0.2cm] \tcm{\frac{h_2}{2}} + \tcs{\frac{h_3}{2}} \\[0.2cm] 
  \tcs{\frac{h_3}{2}} + \tcg{\frac{h_4}{2}} \\[0.2cm] \tcg{\frac{h_4}{2}}
\end{pmatrix}
\]

\newpage

To get the previous system (\ref{eq:sys5.2}), we cross out the first and last rows, and move the highlighted terms to the right hand side:

\begin{center}
    \rule{12.75cm}{0.4pt}
    \vspace{-1.3cm}
\end{center}

\[
\begin{pmatrix}
  \frac{1}{h_1}                 & \frac{-1}{h_1}                                                                                                                \\[0.2cm]
  \cancel{\tce{\frac{-1}{h_1}}} & \frac{1}{h_1} + \frac{1}{h_2} & \frac{-1}{h_2}                                                                                \\[0.2cm]
                                & \frac{-1}{h_2}                & \frac{1}{h_2} + \frac{1}{h_3} & \frac{-1}{h_3}                                                \\[0.2cm]
                                &                               & \frac{-1}{h_3}                & \frac{1}{h_3} + \frac{1}{h_4} & \cancel{\tce{\frac{-1}{h_4}}} \\[0.2cm]
                                &                               &                               & \frac{-1}{h_4}                & \frac{1}{h_4}
\end{pmatrix}
\begin{pmatrix}
  u_0 \\[0.2cm] u_1 \\[0.2cm] u_2 \\[0.2cm] u_3 \\[0.2cm] u_4
\end{pmatrix} = 
f\cdot
\begin{pmatrix}
  \frac{h_1}{2} \\[0.2cm] \frac{h_1}{2} + \frac{h_2}{2} \\[0.2cm] \frac{h_2}{2} + \frac{h_3}{2} \\[0.2cm] 
  \frac{h_3}{2} + \frac{h_4}{2} \\[0.2cm] \frac{h_4}{2}
\end{pmatrix} +
\begin{pmatrix}
  0 \\[0.2cm] u_0\cdot\tce{\frac{1}{h_1}} \\[0.2cm] 0 \\[0.2cm] u_4\cdot\tce{\frac{1}{h_4}} \\[0.2cm] 0
\end{pmatrix}
\]

\begin{center}
    \vspace{-0.8cm}
    \rule{12.75cm}{0.4pt}
\end{center}
\vspace{-0.1cm}
$$\text{\rotatebox{270}{$\leadsto$}}$$

\[
\begin{pmatrix*}[c]
    \frac{1}{h_1} + \frac{1}{h_2} & \frac{-1}{h_2}                 & 0                             \\[0.2cm]
    \frac{-1}{h_2}                & \frac{1}{h_2} + \frac{1}{h_3}  & \frac{-1}{h_3}                \\[0.2cm]
    0                             & \frac{-1}{h_3}                 & \frac{1}{h_3} + \frac{1}{h_4}
  \end{pmatrix*}
\begin{pmatrix}
  u_1 \\[0.2cm] u_2 \\[0.2cm] u_3
\end{pmatrix} = 
f\cdot
\begin{pmatrix}
  \frac{h_1}{2} + \frac{h_2}{2} \\[0.2cm] \frac{h_2}{2} + \frac{h_3}{2} \\[0.2cm] 
  \frac{h_3}{2} + \frac{h_4}{2}
\end{pmatrix} +
\begin{pmatrix}
  u_0\cdot\frac{1}{h_1} \\[0.2cm] 0 \\[0.2cm] u_4\cdot\frac{1}{h_4}
\end{pmatrix}
\]\-\\
And imposing the boundary conditions ($u_0 = 0, \, u_4 = 1$) we obtain the exact same \text{system (\ref{eq:sys5.2}).}

\end{example}
\-\\
Now, we'll see with an example how to assemble the stiffness matrix in 2D:

\begin{example}
  
\end{example}

\newpage

\subsection{FEM analysis}

\begin{remark}
  In this section we'll only see the 1D case, but the analysis works for higher dimensions.
\end{remark}

Let's work with the following problem:

\begin{equation}\label{eq:LAXexample}
    \begin{cases}
      \Delta u = -s &\text{ in } \Omega \\
      u = 0         &\text{ on } \partial\Omega
    \end{cases}
\end{equation}

\underline{\textbf{Weak form}}\\

We have to find $u\in \mathcal{H}_0^1(\Omega)$ such that

\[
  \underbrace{\int_\Omega \nabla\omega\nabla u \, d\Omega}_{a(\omega, u)} = \underbrace{\int_{\Omega} s\omega \, d\Omega}_{l(\omega)} \qquad \forall \omega \in \mathcal{H}_0^1(\Omega)
\]

\underline{\textbf{Discrete problem}}\\

Find $u^h \in V^h$,$\,\,$ ($V^h \subseteq \mathcal{H}_0^1(\Omega)$) $\,\,$ such that 

\[
  a(\omega^h, u^h) = l(\omega^h) \qquad \forall \omega^h \in V^h
\]

We want to compute the error $e = u - u^h$

\[
  \norm{u-u^h} \leq C\cdot \underset{v^h\in V^h}{\text{inf}} \norm{u-v^h} \leq C\cdot\norm{u-\Pi u}
\]

where $\Pi u$ is the projection of $u$. In FEM it's the \textit{interpolating polynomial}.\\
\begin{lemma}[Lax-Milgram]\label{LMthm}\-\\
  Let $V$ be a Hilbert space. Let $$a: V\times V \to \real$$ a continuous, coercive and bilinear form.\\
  Given the weak form:
  \begin{equation}\label{eq:LAXweak}
      \text{Find } u \in V \text{ such that } a(\omega, u) = l(\omega) \qquad \forall \omega\in V
  \end{equation}
  Then (\ref{eq:LAXweak}) has a unique solution and $$\norm{u}_V \leq \frac{1}{\alpha}\norm{l}_V$$
  
  Here,
  \begin{itemize}
      \item[] $a$ is \textbf{continuous} if $\exists M>0$ such that $\abs{a(\omega, u)} \leq M\norm{u}_V\norm{\omega}_V$
      
      \item[] $a$ is \textbf{coercive} if $\exists \alpha>0$ such that $a(u,u) \geq \alpha\norm{u}_V^2$
  \end{itemize}
  
  If moreover $a(\cdot, \cdot)$ is symmetric, then (\ref{eq:LAXweak}) is equivalent to $$      \text{Find } u \in V \text{ such that } J(u) = \underset{v\in V}{\text{min }}J(v), \text{ with } J(v) = \frac{1}{2}a(v,v) + l(v)$$
\end{lemma}

\newpage

\begin{example}
  Let's see that for problem (\ref{eq:LAXexample}), the hypothesis of Lax-Milgram's lemma holds: \\
  
  Of course, $a$ is a bilinear form. Then, we also want to see that $a(\omega,u) = \displaystyle{\int_{\Omega}}\nabla \omega \nabla u \, d\Omega$ is continuous and coercive.\\
  
  We work in $V\subseteq \mathcal{H}_0^1(\Omega)$ with the norm $\norm{u}_V := \norm{\nabla u}$, and $<u,v> = \displaystyle{\int} uv$. Then
  
\begin{align*}
    &\abs{a(\omega, u)} = \abs{\int_{\Omega}\nabla \omega \nabla u \, d\Omega} = \abs{<\nabla\omega,\nabla u>} \underset{\substack{\text{Cauchy-}\\\text{Schwarz}}}{\leq} \norm{\nabla\omega}\cdot\norm{\nabla u} = \norm{\omega}_V\cdot\norm{u}_V \implies a \text{ continuous}\\
    &a(u,u) = \int_{\Omega} (\nabla u)^2 \, d\Omega = \norm{u}_V^2. \text{ In particular } a(u,u) \geq \norm{u}_V^2 \implies a \text{ coercive}
\end{align*}
  
\end{example}


\begin{lemma}[Céa]\-\\
  The Galerkin method is \textbf{strongly consistent}. That is
  
  \[
    a(v^h, \underbrace{u-u^h}_e) = 0 \quad \forall v^h \in V^h
  \]
\end{lemma}

\begin{remark}
  We are assuming that $a$ verifies the hypothesis of Lax-Milgram's lemma (\ref{LMthm})
\end{remark}



\begin{demo}
  Evaluating the weak form (\ref{eq:LAXweak}) on a subspace $V^h \subset V$, it holds
  \begin{align}
      a(v^h,u) = l(v^h)\label{eq:cea1}\\ 
      a(v^h,u^h) = l(v^h) \label{eq:cea2}
  \end{align}
  
  Subtracting (\ref{eq:cea1}) - (\ref{eq:cea2}) we obtain the desired result
  \[
    a(v^h, u-u^h) = 0
  \]
  Where we used that $a$ is bilinear. \\\qed
\end{demo}

\begin{corollary}
  In the same conditions as before, we have the following bound:
  \[
    \norm{u-u^h}_V \leq \frac{M}{\alpha} \norm{u-v^h}_V \quad \forall v^h \in V^h
  \]
\end{corollary}

\begin{demo}
  \begin{align*}
      a(e,e) &= a(u-u^h, u-u^h) =^{(*)}\\
             &= a(u-u^h, u-v^h) + \cancelto{\text{\footnotesize{$0$ (Céa's Lemma)}}}{a(u-u^h, v^h-u^h)} \hspace{-2.75cm}\leq^{(**)}\\[12pt]
             &\leq M\norm{u-u^h}_V\norm{u-v^h}_V
  \end{align*}
  In $(*)$ we added and subtracted $v^h$ and used that $a$ is a bilinear form, and in $(**)$ we used that $a$ is continuous. \\
  
  Now, as $a$ is coercive, we also have $$a(e,e) = a(u-u^h,u-u^h)\leq \alpha \norm{u-u^h}_V^2$$
  \[
    \implies \alpha\norm{u-u^h}_V^2\leq M\norm{u-u^h}_V\norm{u-v^h}_V
  \]
  \[
    \implies \norm{u-u^h}_V \leq \frac{M}{\alpha}\norm{u-v^h}_V
  \]
  \qed
\end{demo}

This result means that the Galerkin approximation $u^h$ is the best we can obtain (up to a constant depending only on the form $a$).\\\-\\

Now our objective is to find an error bound for the FEM solution. We'll use a bound for the interpolation error (We'll do it with 1D FEM for simplicity).\\

We have the domain $\Omega = (a,b)$. Given $x_0 = a, x_1, x_2, \ldots, x_{N-1}, x_N = b$ such that $$x_0 = a < x_1 < x_2 < \ldots < x_{N-1} < x_N = b$$ we define $\tau_h$ as the partition of $(a,b)$ in elements $K_j = (x_{j-1},x_j)\quad$ (with $j=1,2,\ldots,N$)\\

and $$X_h^p = \setb{v^h \in \mathcal{C}^0(\Omega) \,:\, v^h\big|_{K_j}\in\mathbb{P}^p(K_j)} \qquad \varphi_i(x_j) = \delta_{ij}$$

where $\mathbb{P}^p$ are polynomials of degree $p$.

\begin{theorem}
  Let $v\in\mathcal{H}^{p+1}(I)$ and $\Pi_h^p v \in X_h^p$ its interpolating function. Then
  \[
    \abs{v-\Pi_h^p v}_{\mathcal{H}^k(I)} \leq C_{p,k}\cdot h^{p+1-k}\cdot\abs{v}_{\mathcal{H}^{p+1}(I)} \qquad k=0,1,\ldots
  \]
  
  In our case, for $p=1$,
  $$\Pi_h^1 v \in X_h^1(\Omega)$$
  $$\Pi_h^1 v(x_j) = v(x_j) \quad j=0,\ldots,N$$
  
  \[
    \varphi_j(x) = \begin{cases}
      \frac{x-x_{j-1}}{x_j - x_{j-1}}   &\text{ if } x \in K_j=(x_{j-1},x_j)\\[8pt]
      \frac{x-x_{j}}{x_{j+1} - x_j} &\text{ if } x\in K_{j+1} = (x_j,x_{j+1}) \qquad \text{ (Lagrange basis functions)} \\[8pt]
      0 &\text{ otherwise}
  \end{cases}
  \]
  
  $$\Pi_h^1 v = \sum_{j=0}^N v(x_j)\varphi_j(x)$$
\end{theorem}

\begin{demo}
  ($p=1$)\\
  \vspace{-0.5cm}
  $$e=v-\Pi_h^1v$$
  
  Note that $e(x_j) = 0 \underset{Rolle}{\implies} e'(\xi_j)=0$ with $\xi_j \in K_j$\\
  
  In $\displaystyle{K_j,\, e'(x) = \int_{\xi_j}^x e''(s)\,ds = \int_{\xi_j}^x v''(s)\,ds}$, and so
  \[
    \abs{e'(x)} \leq \int_{x_{j-1}}^{x_j} \abs{v''(s)}\,ds \underset{C-S}{\leq} \underbrace{\left(\int_{x_{j-1}}^{x_j}1\,ds\right)^{\frac{1}{2}}}_{h^{\frac{1}{2}}}\left(\int_{x_{j-1}}^{x_j} \abs{v''(s)}^2 \, ds\right)^{\frac{1}{2}}
  \]
  
  We square both sides
  
  \[
    \abs{e'(x)}^2 \leq h \int_{x_{j-1}}^{x_j} \abs{v''(s)}^2 \, ds
  \]
  
  and integrate in $K_j$
  
  \[
    \int_{x_{j-1}}^{x_j}\abs{e'(x)}^2 \leq h\cdot \hspace{-2.6cm}\underset{\substack{\Big\uparrow \\ \text{Comes from integrating}\\\int_{x_{j-1}}^{x_j}\int_{x_{j-1}}^{x_j}(\,\,) = \int_{x_{j-1}}^{x_j}(\,\,)\,\cdot\,\underbrace{(x_j - x_{j-1})}_{h}}}{h}\hspace{-2.6cm}\cdot \int_{x_{j-1}}^{x_j} \abs{v''(s)}^2 \, ds \tag{$*$}
  \]
  
  Then we have $e(x) = \displaystyle{\int_{x_{j-1}}^x e'(s)\,ds}$ for $x\in K_j$. Thus
  
  \[
    \abs{e(x)} \leq \int_{x_{j-1}}^{x_j}\abs{e'(s)}\,ds \leq h^{\frac{1}{2}}\left(\int_{x_{j-1}}^{x_j}\abs{e'(s)}^2\,ds\right)^{\frac{1}{2}} \overset{(*)}{\leq} h^{\frac{1}{2}}\cdot h \cdot \left(\int_{x_{j-1}}^{x_j}\abs{v''(s)}^2\,ds\right)^{\frac{1}{2}}
  \]\-\\
  and again, if we square and integrate both sides, we end up with
  
  \[
    \int_{x_{j-1}}^{x_j}\abs{e(x)}^2 \leq h^4\int_{x_{j-1}}^{x_j}\abs{v''(s)}^2\,ds
  \]
  
  To summarize, we have
  \begin{align*}
      \int_{K_j}\abs{e(x)}^2 &\leq h^4\int_{K_j}\abs{v''(s)}^2\,ds\\
      \int_{K_j}\abs{e'(x)}^2 &\leq h^2\int_{K_j}\abs{v''(s)}^2\,ds
  \end{align*}
  
  and if we sum for all the elements,
  \begin{align*}
      \norm{e(x)_{\mathcal{L}_2}^2} &\leq h^4\abs{v}_{\mathcal{H}^2}^2 \implies \norm{e}_{\mathcal{L}_2} \leq C_1h^2\\[10pt]
      \abs{e(x)_{\mathcal{H}^1}^2} &\leq h^2\abs{v}_{\mathcal{H}^2}^2 \implies \abs{e}_{\mathcal{H}^1} \leq C_2h
  \end{align*}
  \qed
\end{demo}

\begin{remark}
  In $\mathcal{H}^p(\Omega)$ we have \begin{itemize}
      \item[-] Norm: $\norm{v}_{\mathcal{H}^p} = \sum\limits_{k=0}^p \abs{v}_{\mathcal{H}^k}$
      \item[-] Seminorm: $\displaystyle{\abs{v}_{\mathcal{H}^k}^2 = \int_{\Omega}\left(\frac{D^kv}{Dx^k}\right)^2\, d\Omega}$
  \end{itemize}
\end{remark}

\begin{corollary}
  \begin{align*}
      &\norm{u-u^h}_{\mathcal{H}^p(\Omega)} \leq \frac{M}{\alpha}\inf_{v^h\in\mathcal{H}_0^p(\Omega)}\norm{u-v^h}_{\mathcal{H}_0^p(\Omega)} \hspace{-0.4cm}\underset{\substack{\big\uparrow \\ u^h = \Pi^hu}}{\leq} \hspace{-0.4cm}\frac{M}{\alpha} Ch^p\\
      &\norm{u-u^h}_{\mathcal{L_2}} \leq Kh^{p+1}
  \end{align*}
\end{corollary}




















